# New backend everytime - Error refreshing state: state data in S3 does not have the expected content

**ThiagoScodeler** commented *Oct 12, 2023*

**Describe the bug**
I'm getting the "_Error refreshing state: state data in S3 does not have the expected content."_ when trying to use terragrunt/terraform resources locally after have created these resources with terragrunt/terraform by using Github actions.
The same error happens doing the opposite: crate resources from my local machine and then try to update by using Github actions.

I suppose Terragrunt should consider the remote backend state if it already exists instead of trying to create a new one.

**Error - terragrunt run-all plan:**
```
Initializing the backend...

Successfully configured the backend "s3"! Terraform will automatically
use this backend unless the backend configuration changes.
Error refreshing state: state data in S3 does not have the expected content.

This may be caused by unusually long delays in S3 processing a previous state
update.  Please wait for a minute or two and try again. If this problem
persists, and neither S3 nor DynamoDB are experiencing an outage, you may need
to manually verify the remote state and update the Digest value stored in the
DynamoDB table to the following value:
```

If I delete the Digest value on DynamoDB table, the next `terragrunt run-all plan` execution plans to create all the resources again as with they were new.

**To Reproduce**
1) Create any AWS resource by using Terraform/Terragrunt. This action is going to initialize your backend and dynamodb lock table.
2) Try to update or create new resources by using the same code but running terragrunt commands from a different source.

terragrunt.hcl:
```hcl
locals {
  region = "us-east-2"
}

generate "provider" {
  path      = "provider.tf"
  if_exists = "overwrite_terragrunt"
  contents  = <<EOF
    provider "aws" {
      region = "${local.region}"
    }
  EOF
}

remote_state {
  backend = "s3"
  config = {
    bucket         = "code-backend"
    key            = "${path_relative_to_include()}/terraform.tfstate"
    region         = "${local.region}"
    encrypt        = true
    dynamodb_table = "lock-table"
  }
  generate = {
    path      = "backend.tf"
    if_exists = "overwrite_terragrunt"
  }
}
```

version.tf
```
terraform {
  required_version = ">= 1.0"

  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0"
    }
  }
}
```

.gitignore:
```
**/.terraform/*
*.tfstate
*.tfstate.*
.*.sw?
.idea
terragrunt.iml
.terraform
*.tfstate
*.tfstate.backup
*.out
.terragrunt-cache
.bundle
.terraform.lock.hcl
terragrunt
```
backend.tf:
```
# Generated by Terragrunt. Sig: 
terraform {
  backend "s3" {
    bucket         = "code-backend"
    dynamodb_table = "lock-table"
    encrypt        = true
    key            = "./terraform.tfstate"
    region         = "us-east-2"
  }
}
```

provider.tf:
```
# Generated by Terragrunt. Sig: 
    provider "aws" {
      region = "us-east-2"
    }
```

folder structure:
```
code/
    - backend.tf
    - provider.tf
    - resources.tf
    - variables.tf
    - version.tf
    - terragrunt.hcl
```

**Expected behavior**
Terragrunt execution takes in consideration the backend remote state if it already exists and does not initialize a new backend.

**Versions**
- Terragrunt version: v0.45.2
- Terraform version: v1.4.0
- Environment details (Ubuntu 20.04, Windows 10, etc.): Ubuntu 20.04.4 LTS
<br />
***



# Terragrunt plan doesnt work in GitHub Actions

**zahornyak** commented *Mar 22, 2023*

Hi all,

I'm using Terragrunt for my project and trying to set up Github actions for all this stuff. But when I'm trying to run `plan` or `run-all plan`, It makes init, then it starts refreshing the state, and then Github actions make the next steps, and I can't see any plan there.

Here's my pipeline.yml:
```
name: pipeline gateway infra changes
run-name: ${{ github.actor }} requested terragrunt infra update

on:
  push:
    branches:
      - master
      - develop
      - feature/UP-3056
    paths:
      - 'infrastructure/terraform/core/**'
      - 'infrastructure/terragrunt/eu-central-1/_env/gateway.hcl'
      - 'infrastructure/terragrunt/eu-central-1/development/gateway/**'
      - 'infrastructure/terragrunt/eu-central-1/production/gateway/**'
      - '.github/workflows/pipeline-gateway.yml'

  pull_request:
    types:
      - opened
      - reopened
      - synchronize
      - ready_for_review
    branches:
      - develop
      - master
      - feature/UP-3056
    paths:
      - 'infrastructure/terraform/core/**'
      - 'infrastructure/terragrunt/eu-central-1/_env/gateway.hcl'
      - 'infrastructure/terragrunt/eu-central-1/development/gateway/**'
      - 'infrastructure/terragrunt/eu-central-1/production/gateway/**'
      - '.github/workflows/pipeline-gateway.yml'

jobs:
  pipeline-core-infra:
    environment:
      name: ${{ (github.ref == 'refs/heads/master' && 'production') || (github.ref == 'refs/heads/develop' && 'development') || (github.base_ref == 'master' && 'production') || (github.base_ref == 'develop' && 'development') || (github.ref == 'refs/heads/feature/UP-3056' && 'development') || (github.base_ref == 'feature/UP-3056' && 'development')}}
    runs-on: ubuntu-latest

    env:
      SERVICE_NAME: gateway
      ENVIRONMENT: ${{ secrets.ENVIRONMENT }}
      AWS_REGION: ${{ secrets.AWS_REGION }}
      AWS_ACCESS_KEY_ID: ${{ secrets.INFRA_AWS_ACCESS_KEY }}
      AWS_SECRET_ACCESS_KEY: ${{ secrets.INFRA_AWS_SECRET_ACCESS_KEY }}
      TF_VAR_environment: ${{ secrets.ENVIRONMENT }}
      AWS_CSM_ENABLED: false

    defaults:
      run:
        shell: bash

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Configure AWS Credentials
        uses: aws-actions/configure-aws-credentials@v1
        with:
          aws-region: ${{ secrets.AWS_REGION }}
          aws-access-key-id: ${{ secrets.INFRA_AWS_ACCESS_KEY }}
          aws-secret-access-key: ${{ secrets.INFRA_AWS_SECRET_ACCESS_KEY }}

      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v2
        with:
          terraform_version: 1.4.0
          terraform_wrapper: true

      - name: Install Terragrunt
        run: |
          TERRAGRUNT_VERSION="v0.44.5"
          wget -q https://github.com/gruntwork-io/terragrunt/releases/download/${TERRAGRUNT_VERSION}/terragrunt_linux_amd64 -O terragrunt
          chmod +x terragrunt
          sudo mv terragrunt /usr/local/bin/

      - name: Terragrunt Plan
        working-directory: infrastructure/terragrunt/eu-central-1/${{ env.ENVIRONMENT }}/${{ env.SERVICE_NAME }}
        id: plan
        if: ${{ github.event_name == 'pull_request' }}
        run: terragrunt plan -no-color -input=false -lock=false --terragrunt-include-external-dependencies --terragrunt-fetch-dependency-output-from-state

      - name: Update Pull Request
        uses: actions/github-script@v6
        if: github.event_name == 'pull_request'
        env:
          PLAN: ${{ steps.plan.outputs.stdout }}
        with:
          script: |
            const output = `#### Terragrunt Plan Pipeline ${{ env.SERVICE_NAME }} ðŸ“–\`${{ steps.plan.outcome }}\`

            <details><summary>Show Plan</summary>

            \`\`\`\n
            Changes:\n${process.env.PLAN}
            \`\`\`

            </details>

            *Pushed by: @${{ github.actor }}, Action: \`${{ github.event_name }}\`*`;

            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: output
            })

      - name: Terragrunt Plan Status
        if: steps.plan.outcome == 'failure'
        run: exit 1

      - name: Terragrunt Apply
        working-directory: infrastructure/terragrunt/eu-central-1/${{ env.ENVIRONMENT }}/${{ env.SERVICE_NAME }}
        if: (github.ref == 'refs/heads/master' || github.ref == 'refs/heads/develop') && github.event_name == 'push'
        run: terragrunt run-all apply -auto-approve -input=false --terragrunt-include-external-dependencies

```


Here`s job with github actions debug on:
```
2023-03-22T11:58:03.9075774Z ##[debug]Evaluating condition for step: 'Terragrunt Plan'
2023-03-22T11:58:03.9101064Z ##[debug]Evaluating: (success() && (github.event_name == 'pull_request'))
2023-03-22T11:58:03.9101644Z ##[debug]Evaluating And:
2023-03-22T11:58:03.9106429Z ##[debug]..Evaluating success:
2023-03-22T11:58:03.9106956Z ##[debug]..=> true
2023-03-22T11:58:03.9107399Z ##[debug]..Evaluating Equal:
2023-03-22T11:58:03.9108783Z ##[debug]....Evaluating Index:
2023-03-22T11:58:03.9109171Z ##[debug]......Evaluating github:
2023-03-22T11:58:03.9109546Z ##[debug]......=> Object
2023-03-22T11:58:03.9109920Z ##[debug]......Evaluating String:
2023-03-22T11:58:03.9110306Z ##[debug]......=> 'event_name'
2023-03-22T11:58:03.9110728Z ##[debug]....=> 'pull_request'
2023-03-22T11:58:03.9111099Z ##[debug]....Evaluating String:
2023-03-22T11:58:03.9111467Z ##[debug]....=> 'pull_request'
2023-03-22T11:58:03.9115351Z ##[debug]..=> true
2023-03-22T11:58:03.9115896Z ##[debug]=> true
2023-03-22T11:58:03.9120236Z ##[debug]Expanded: (true && ('pull_request' == 'pull_request'))
2023-03-22T11:58:03.9120776Z ##[debug]Result: true
2023-03-22T11:58:03.9121393Z ##[debug]Starting: Terragrunt Plan
2023-03-22T11:58:03.9131363Z ##[debug]Loading inputs
2023-03-22T11:58:03.9134357Z ##[debug]Evaluating: format('infrastructure/terragrunt/***/{0}/{1}', env.ENVIRONMENT, env.SERVICE_NAME)
2023-03-22T11:58:03.9135049Z ##[debug]Evaluating format:
2023-03-22T11:58:03.9152413Z ##[debug]..Evaluating String:
2023-03-22T11:58:03.9152856Z ##[debug]..=> 'infrastructure/terragrunt/***/{0}/{1}'
2023-03-22T11:58:03.9178757Z ##[debug]..Evaluating Index:
2023-03-22T11:58:03.9179094Z ##[debug]....Evaluating env:
2023-03-22T11:58:03.9179391Z ##[debug]....=> Object
2023-03-22T11:58:03.9179684Z ##[debug]....Evaluating String:
2023-03-22T11:58:03.9179978Z ##[debug]....=> 'ENVIRONMENT'
2023-03-22T11:58:03.9182013Z ##[debug]..=> '***'
2023-03-22T11:58:03.9183107Z ##[debug]..Evaluating Index:
2023-03-22T11:58:03.9183391Z ##[debug]....Evaluating env:
2023-03-22T11:58:03.9183680Z ##[debug]....=> Object
2023-03-22T11:58:03.9183976Z ##[debug]....Evaluating String:
2023-03-22T11:58:03.9184259Z ##[debug]....=> 'SERVICE_NAME'
2023-03-22T11:58:03.9184604Z ##[debug]..=> 'gateway'
2023-03-22T11:58:03.9185082Z ##[debug]=> 'infrastructure/terragrunt/***/***/gateway'
2023-03-22T11:58:03.9185575Z ##[debug]Result: 'infrastructure/terragrunt/***/***/gateway'
2023-03-22T11:58:03.9186025Z ##[debug]Loading env
2023-03-22T11:58:03.9191114Z ##[group]Run terragrunt plan -no-color -input=false -lock=false --terragrunt-include-external-dependencies --terragrunt-fetch-dependency-output-from-state
2023-03-22T11:58:03.9191958Z [36;1mterragrunt plan -no-color -input=false -lock=false --terragrunt-include-external-dependencies --terragrunt-fetch-dependency-output-from-state[0m
2023-03-22T11:58:03.9245498Z shell: /usr/bin/bash --noprofile --norc -e -o pipefail {0}
2023-03-22T11:58:03.9245794Z env:
2023-03-22T11:58:03.9246025Z   SERVICE_NAME: gateway
2023-03-22T11:58:03.9246315Z   ENVIRONMENT: ***
2023-03-22T11:58:03.9246579Z   AWS_REGION: ***
2023-03-22T11:58:03.9246873Z   AWS_ACCESS_KEY_ID: ***
2023-03-22T11:58:03.9247220Z   AWS_SECRET_ACCESS_KEY: ***
2023-03-22T11:58:03.9247508Z   TF_VAR_environment: ***
2023-03-22T11:58:03.9247769Z   AWS_CSM_ENABLED: false
2023-03-22T11:58:03.9248048Z   AWS_DEFAULT_REGION: ***
2023-03-22T11:58:03.9248398Z   TERRAFORM_CLI_PATH: /home/runner/work/_temp/3979814a-9174-4b61-81f8-77bf3f5f84ad
2023-03-22T11:58:03.9248715Z ##[endgroup]
2023-03-22T11:58:03.9250504Z ##[debug]Overwrite 'shell' base on job defaults.
2023-03-22T11:58:03.9303384Z ##[debug]/usr/bin/bash --noprofile --norc -e -o pipefail /home/runner/work/_temp/fb744b8d-46ef-41e2-98c0-a7ca6d7604d9.sh
2023-03-22T11:58:04.4689976Z time=2023-03-22T11:58:04Z level=warning msg=No double-slash (//) found in source URL /home/runner/work/pipeline/pipeline/infrastructure/terraform/core. Relative paths in downloaded Terraform code may not work. prefix=[/home/runner/work/pipeline/pipeline/infrastructure/terragrunt/***/***/core] 
2023-03-22T11:58:05.2287074Z time=2023-03-22T11:58:05Z level=warning msg=No double-slash (//) found in source URL /home/runner/work/pipeline/pipeline/infrastructure/terraform/ecs_service. Relative paths in downloaded Terraform code may not work.
2023-03-22T11:58:05.2309912Z time=2023-03-22T11:58:05Z level=warning msg=Encryption is not enabled on the S3 remote state bucket uptain-terraform-state-***. Terraform state files may contain secrets, so we STRONGLY recommend enabling encryption! prefix=[/home/runner/work/pipeline/pipeline/infrastructure/terragrunt/***/***/gateway] 
2023-03-22T11:58:06.4661679Z [command]/home/runner/work/_temp/3979814a-9174-4b61-81f8-77bf3f5f84ad/terraform-bin init
2023-03-22T11:58:06.4984558Z 
2023-03-22T11:58:06.4985315Z [0m[1mInitializing the backend...[0m
2023-03-22T11:58:06.9176608Z [0m[32m
2023-03-22T11:58:06.9177102Z Successfully configured the backend "s3"! Terraform will automatically
2023-03-22T11:58:06.9177664Z use this backend unless the backend configuration changes.[0m
2023-03-22T11:58:08.2037771Z [0m[1mInitializing modules...[0m
2023-03-22T11:58:08.2631489Z Downloading registry.terraform.io/terraform-aws-modules/security-group/aws 4.17.1 for backend_container_sg...
2023-03-22T11:58:08.6540270Z - backend_container_sg in .terraform/modules/backend_container_sg
2023-03-22T11:58:08.6677704Z Downloading registry.terraform.io/terraform-aws-modules/iam/aws 4.24.1 for ecs_task_execution_role...
2023-03-22T11:58:09.0229501Z - ecs_task_execution_role in .terraform/modules/ecs_task_execution_role/modules/iam-assumable-role
2023-03-22T11:58:09.0238794Z Downloading registry.terraform.io/terraform-aws-modules/iam/aws 4.24.1 for ecs_task_policy...
2023-03-22T11:58:09.0308885Z - ecs_task_policy in .terraform/modules/ecs_task_policy/modules/iam-policy
2023-03-22T11:58:09.0314161Z Downloading registry.terraform.io/terraform-aws-modules/iam/aws 4.24.1 for ecs_task_role...
2023-03-22T11:58:09.0408655Z - ecs_task_role in .terraform/modules/ecs_task_role/modules/iam-assumable-role
2023-03-22T11:58:09.0535180Z Downloading registry.terraform.io/cloudposse/ecs-container-definition/aws 0.58.2 for envoy_container_definition...
2023-03-22T11:58:09.3618634Z - envoy_container_definition in .terraform/modules/envoy_container_definition
2023-03-22T11:58:09.3725411Z Downloading registry.terraform.io/terraform-aws-modules/route53/aws 2.10.2 for records_alb...
2023-03-22T11:58:09.6457469Z - records_alb in .terraform/modules/records_alb/modules/records
2023-03-22T11:58:09.6458513Z Downloading registry.terraform.io/terraform-aws-modules/route53/aws 2.10.2 for records_alb_admin...
2023-03-22T11:58:09.6481947Z - records_alb_admin in .terraform/modules/records_alb_admin/modules/records
2023-03-22T11:58:09.6484540Z Downloading registry.terraform.io/cloudposse/ecs-container-definition/aws 0.58.2 for service_container_definition...
2023-03-22T11:58:09.6536845Z - service_container_definition in .terraform/modules/service_container_definition
2023-03-22T11:58:09.6539374Z Downloading registry.terraform.io/cloudposse/ecs-container-definition/aws 0.58.2 for service_worker_container_definition...
2023-03-22T11:58:09.6601330Z - service_worker_container_definition in .terraform/modules/service_worker_container_definition
2023-03-22T11:58:09.7019581Z 
2023-03-22T11:58:09.7020424Z [0m[1mInitializing provider plugins...[0m
2023-03-22T11:58:09.7021265Z - Finding hashicorp/aws versions matching ">= 2.49.0, >= 3.29.0, >= 3.34.0, >= 3.35.0, ~> 4.37"...
2023-03-22T11:58:09.7391420Z - Installing hashicorp/aws v4.59.0...
2023-03-22T11:58:13.1841618Z - Installed hashicorp/aws v4.59.0 (signed by HashiCorp)
2023-03-22T11:58:13.1841954Z 
2023-03-22T11:58:13.1842327Z Terraform has created a lock file [1m.terraform.lock.hcl[0m to record the provider
2023-03-22T11:58:13.1842851Z selections it made above. Include this file in your version control repository
2023-03-22T11:58:13.1843340Z so that Terraform can guarantee to make the same selections by default when
2023-03-22T11:58:13.1843826Z you run "terraform init" in the future.[0m
2023-03-22T11:58:13.1844038Z 
2023-03-22T11:58:13.1844707Z [0m[1m[32mTerraform has been successfully initialized![0m[32m[0m
2023-03-22T11:58:13.1845081Z [0m[32m
2023-03-22T11:58:13.1845456Z You may now begin working with Terraform. Try running "terraform plan" to see
2023-03-22T11:58:13.1845947Z any changes that are required for your infrastructure. All Terraform commands
2023-03-22T11:58:13.1846346Z should now work.
2023-03-22T11:58:13.1846527Z 
2023-03-22T11:58:13.1846746Z If you ever set or change modules or backend configuration for Terraform,
2023-03-22T11:58:13.1847232Z rerun this command to reinitialize your working directory. If you forget, other
2023-03-22T11:58:13.1847777Z commands will detect it and remind you to do so if necessary.[0m
2023-03-22T11:58:13.1901484Z ##[debug]Terraform exited with code 0.
2023-03-22T11:58:13.1903534Z ##[debug]stdout: 
2023-03-22T11:58:13.1903832Z ##[debug][0m[1mInitializing the backend...[0m
2023-03-22T11:58:13.1904118Z ##[debug][0m[32m
2023-03-22T11:58:13.1904457Z ##[debug]Successfully configured the backend "s3"! Terraform will automatically
2023-03-22T11:58:13.1904891Z ##[debug]use this backend unless the backend configuration changes.[0m
2023-03-22T11:58:13.1905249Z ##[debug][0m[1mInitializing modules...[0m
2023-03-22T11:58:13.1905701Z ##[debug]Downloading registry.terraform.io/terraform-aws-modules/security-group/aws 4.17.1 for backend_container_sg...
2023-03-22T11:58:13.1906621Z ##[debug]- backend_container_sg in .terraform/modules/backend_container_sg
2023-03-22T11:58:13.1907099Z ##[debug]Downloading registry.terraform.io/terraform-aws-modules/iam/aws 4.24.1 for ecs_task_execution_role...
2023-03-22T11:58:13.1907622Z ##[debug]- ecs_task_execution_role in .terraform/modules/ecs_task_execution_role/modules/iam-assumable-role
2023-03-22T11:58:13.1908144Z ##[debug]Downloading registry.terraform.io/terraform-aws-modules/iam/aws 4.24.1 for ecs_task_policy...
2023-03-22T11:58:13.1908617Z ##[debug]- ecs_task_policy in .terraform/modules/ecs_task_policy/modules/iam-policy
2023-03-22T11:58:13.1909098Z ##[debug]Downloading registry.terraform.io/terraform-aws-modules/iam/aws 4.24.1 for ecs_task_role...
2023-03-22T11:58:13.1909570Z ##[debug]- ecs_task_role in .terraform/modules/ecs_task_role/modules/iam-assumable-role
2023-03-22T11:58:13.1910077Z ##[debug]Downloading registry.terraform.io/cloudposse/ecs-container-definition/aws 0.58.2 for envoy_container_definition...
2023-03-22T11:58:13.1910589Z ##[debug]- envoy_container_definition in .terraform/modules/envoy_container_definition
2023-03-22T11:58:13.1911059Z ##[debug]Downloading registry.terraform.io/terraform-aws-modules/route53/aws 2.10.2 for records_alb...
2023-03-22T11:58:13.1911512Z ##[debug]- records_alb in .terraform/modules/records_alb/modules/records
2023-03-22T11:58:13.1911970Z ##[debug]Downloading registry.terraform.io/terraform-aws-modules/route53/aws 2.10.2 for records_alb_admin...
2023-03-22T11:58:13.1912443Z ##[debug]- records_alb_admin in .terraform/modules/records_alb_admin/modules/records
2023-03-22T11:58:13.1912957Z ##[debug]Downloading registry.terraform.io/cloudposse/ecs-container-definition/aws 0.58.2 for service_container_definition...
2023-03-22T11:58:13.1913474Z ##[debug]- service_container_definition in .terraform/modules/service_container_definition
2023-03-22T11:58:13.1914014Z ##[debug]Downloading registry.terraform.io/cloudposse/ecs-container-definition/aws 0.58.2 for service_worker_container_definition...
2023-03-22T11:58:13.1914567Z ##[debug]- service_worker_container_definition in .terraform/modules/service_worker_container_definition
2023-03-22T11:58:13.1914910Z ##[debug]
2023-03-22T11:58:13.1915243Z ##[debug][0m[1mInitializing provider plugins...[0m
2023-03-22T11:58:13.1915633Z ##[debug]- Finding hashicorp/aws versions matching ">= 2.49.0, >= 3.29.0, >= 3.34.0, >= 3.35.0, ~> 4.37"...
2023-03-22T11:58:13.1915999Z ##[debug]- Installing hashicorp/aws v4.59.0...
2023-03-22T11:58:13.1916349Z ##[debug]- Installed hashicorp/aws v4.59.0 (signed by HashiCorp)
2023-03-22T11:58:13.1916642Z ##[debug]
2023-03-22T11:58:13.1917111Z ##[debug]Terraform has created a lock file [1m.terraform.lock.hcl[0m to record the provider
2023-03-22T11:58:13.1917566Z ##[debug]selections it made above. Include this file in your version control repository
2023-03-22T11:58:13.1918002Z ##[debug]so that Terraform can guarantee to make the same selections by default when
2023-03-22T11:58:13.1918392Z ##[debug]you run "terraform init" in the future.[0m
2023-03-22T11:58:13.1918662Z ##[debug]
2023-03-22T11:58:13.1918976Z ##[debug][0m[1m[32mTerraform has been successfully initialized![0m[32m[0m
2023-03-22T11:58:13.1919292Z ##[debug][0m[32m
2023-03-22T11:58:13.1919637Z ##[debug]You may now begin working with Terraform. Try running "terraform plan" to see
2023-03-22T11:58:13.1920071Z ##[debug]any changes that are required for your infrastructure. All Terraform commands
2023-03-22T11:58:13.1920414Z ##[debug]should now work.
2023-03-22T11:58:13.1920648Z ##[debug]
2023-03-22T11:58:13.1920964Z ##[debug]If you ever set or change modules or backend configuration for Terraform,
2023-03-22T11:58:13.1921400Z ##[debug]rerun this command to reinitialize your working directory. If you forget, other
2023-03-22T11:58:13.1921824Z ##[debug]commands will detect it and remind you to do so if necessary.[0m
2023-03-22T11:58:13.1922127Z ##[debug]
2023-03-22T11:58:13.1922668Z ##[debug]stderr: 
2023-03-22T11:58:13.1946541Z ##[debug]exitcode: 0
2023-03-22T11:58:13.2544087Z [command]/home/runner/work/_temp/3979814a-9174-4b61-81f8-77bf3f5f84ad/terraform-bin plan -no-color -input=false -lock=false
2023-03-22T11:58:18.1408456Z aws_service_discovery_service.service: Refreshing state... [id=srv-izgxsrt2qiapipfr]
2023-03-22T11:58:18.1469074Z aws_lb_target_group.service[0]: Refreshing state... [id=arn:aws:elasticloadbalancing:***:***:targetgroup/alb-***-gateway/9fd77cca51c4349f]
2023-03-22T11:58:18.1475073Z aws_cloudwatch_log_group.service_logs: Refreshing state... [id=***-gateway-logs]
2023-03-22T11:58:18.1483275Z aws_lb_target_group.service_admin[0]: Refreshing state... [id=arn:aws:elasticloadbalancing:***:***:targetgroup/admin-***-gateway/e6a2d97a5d1e492e]
2023-03-22T11:58:18.1490604Z aws_cloudwatch_log_group.envoy_logs: Refreshing state... [id=***-gateway-envoy-logs]
2023-03-22T11:58:18.1497004Z aws_appmesh_virtual_gateway.ingress[0]: Refreshing state... [id=65d8af21-10ff-4afc-adba-b75339a14945]
2023-03-22T11:58:18.1514140Z module.records_alb_admin[0].data.aws_route53_zone.this[0]: Reading...
2023-03-22T11:58:18.1592160Z data.aws_iam_policy_document.ecs_task_policy: Reading...
2023-03-22T11:58:18.1593131Z module.backend_container_sg.aws_security_group.this_name_prefix[0]: Refreshing state... [id=sg-0ed0ad9ce0caf3332]
2023-03-22T11:58:18.1689209Z data.aws_iam_policy_document.ecs_task_policy: Read complete after 0s [id=2177423719]
2023-03-22T11:58:18.1696239Z module.records_alb[0].data.aws_route53_zone.this[0]: Reading...
2023-03-22T11:58:18.1734047Z module.ecs_task_execution_role.data.aws_iam_policy_document.assume_role[0]: Reading...
2023-03-22T11:58:18.1757051Z module.ecs_task_execution_role.data.aws_iam_policy_document.assume_role[0]: Read complete after 0s [id=3683910268]
2023-03-22T11:58:18.1799399Z module.ecs_task_role.data.aws_iam_policy_document.assume_role[0]: Reading...
2023-03-22T11:58:18.1829553Z module.ecs_task_role.data.aws_iam_policy_document.assume_role[0]: Read complete after 0s [id=3683910268]
2023-03-22T11:58:18.1861492Z module.ecs_task_execution_role.aws_iam_role.this[0]: Refreshing state... [id=***-gatewayEcsTaskExecutionRole]
2023-03-22T11:58:18.3193751Z module.ecs_task_role.aws_iam_role.this[0]: Refreshing state... [id=***-gatewayEcsTaskRole]
2023-03-22T11:58:18.4253273Z module.ecs_task_policy.aws_iam_policy.policy[0]: Refreshing state... [id=arn:aws:iam::***:policy/***-gatewayEcsTaskPolicy]
2023-03-22T11:58:18.4646190Z module.records_alb[0].data.aws_route53_zone.this[0]: Read complete after 0s [id=Z07324142IRNV5R7DVHZ3]
2023-03-22T11:58:18.4665800Z module.ecs_task_execution_role.aws_iam_role_policy_attachment.custom[0]: Refreshing state... [id=***-gatewayEcsTaskExecutionRole-20230308173843538800000003]
2023-03-22T11:58:18.4895555Z module.records_alb[0].aws_route53_record.this["gateway A"]: Refreshing state... [id=Z07324142IRNV5R7DVHZ3_gateway.dev.uptain.io_A]
2023-03-22T11:58:18.5229432Z module.ecs_task_role.aws_iam_role_policy_attachment.custom[1]: Refreshing state... [id=***-gatewayEcsTaskRole-20230308173843571400000004]
2023-03-22T11:58:18.5604155Z module.ecs_task_role.aws_iam_role_policy_attachment.custom[0]: Refreshing state... [id=***-gatewayEcsTaskRole-20230308173843573000000005]
2023-03-22T11:58:18.6620175Z module.records_alb_admin[0].data.aws_route53_zone.this[0]: Read complete after 1s [id=Z07324142IRNV5R7DVHZ3]
2023-03-22T11:58:18.6662699Z module.records_alb_admin[0].aws_route53_record.this["admin-gateway A"]: Refreshing state... [id=Z07324142IRNV5R7DVHZ3_admin-gateway.dev.uptain.io_A]
2023-03-22T11:58:18.7033928Z module.backend_container_sg.aws_security_group_rule.ingress_with_cidr_blocks[1]: Refreshing state... [id=sgrule-2854334244]
2023-03-22T11:58:18.7079115Z module.backend_container_sg.aws_security_group_rule.egress_rules[0]: Refreshing state... [id=sgrule-2544472721]
2023-03-22T11:58:18.7079842Z module.backend_container_sg.aws_security_group_rule.ingress_with_cidr_blocks[0]: Refreshing state... [id=sgrule-2011127756]
2023-03-22T11:58:18.7152692Z aws_ecs_task_definition.service: Refreshing state... [id=***_gateway_task]
2023-03-22T11:58:18.8049676Z aws_lb_listener_rule.service[0]: Refreshing state... [id=arn:aws:elasticloadbalancing:***:***:listener-rule/app/***-alb/a01d64a3038cfcba/e4bee5109d5598d6/a1ae966abe45df8a]
2023-03-22T11:58:18.8083654Z aws_lb_listener_rule.service_admin[0]: Refreshing state... [id=arn:aws:elasticloadbalancing:***:***:listener-rule/app/***-alb/a01d64a3038cfcba/e4bee5109d5598d6/7f68d9419579715e]
2023-03-22T11:58:19.1340754Z aws_ecs_service.service: Refreshing state... [id=arn:aws:ecs:***:***:service/***-cluster/***_gateway_service]
2023-03-22T11:58:19.5772575Z aws_appautoscaling_target.backend_scaling: Refreshing state... [id=service/***-cluster/***_gateway_service]
2023-03-22T11:58:19.8947907Z aws_appautoscaling_policy.target_tracking_scaling_memory_backend: Refreshing state... [id=TargetTrackingScaling_memory_backend-***]
2023-03-22T11:58:19.8961365Z aws_appautoscaling_policy.target_tracking_scaling_cpu_backend: Refreshing state... [id=TargetTrackingScaling_cpu_backend-***]
2023-03-22T11:58:20.3746459Z ##[debug]Terraform exited with code 0.
2023-03-22T11:58:20.3750862Z ##[debug]stdout: aws_service_discovery_service.service: Refreshing state... [id=srv-izgxsrt2qiapipfr]
2023-03-22T11:58:20.3751565Z ##[debug]aws_lb_target_group.service[0]: Refreshing state... [id=arn:aws:elasticloadbalancing:***:***:targetgroup/alb-***-gateway/9fd77cca51c4349f]
2023-03-22T11:58:20.3752137Z ##[debug]aws_cloudwatch_log_group.service_logs: Refreshing state... [id=***-gateway-logs]
2023-03-22T11:58:20.3752750Z ##[debug]aws_lb_target_group.service_admin[0]: Refreshing state... [id=arn:aws:elasticloadbalancing:***:***:targetgroup/admin-***-gateway/e6a2d97a5d1e492e]
2023-03-22T11:58:20.3753359Z ##[debug]aws_cloudwatch_log_group.envoy_logs: Refreshing state... [id=***-gateway-envoy-logs]
2023-03-22T11:58:20.3753848Z ##[debug]aws_appmesh_virtual_gateway.ingress[0]: Refreshing state... [id=65d8af21-10ff-4afc-adba-b75339a14945]
2023-03-22T11:58:20.3754324Z ##[debug]module.records_alb_admin[0].data.aws_route53_zone.this[0]: Reading...
2023-03-22T11:58:20.3754724Z ##[debug]data.aws_iam_policy_document.ecs_task_policy: Reading...
2023-03-22T11:58:20.3755188Z ##[debug]module.backend_container_sg.aws_security_group.this_name_prefix[0]: Refreshing state... [id=sg-0ed0ad9ce0caf3332]
2023-03-22T11:58:20.3755673Z ##[debug]data.aws_iam_policy_document.ecs_task_policy: Read complete after 0s [id=2177423719]
2023-03-22T11:58:20.3756092Z ##[debug]module.records_alb[0].data.aws_route53_zone.this[0]: Reading...
2023-03-22T11:58:20.3756520Z ##[debug]module.ecs_task_execution_role.data.aws_iam_policy_document.assume_role[0]: Reading...
2023-03-22T11:58:20.3757018Z ##[debug]module.ecs_task_execution_role.data.aws_iam_policy_document.assume_role[0]: Read complete after 0s [id=3683910268]
2023-03-22T11:58:20.3757804Z ##[debug]module.ecs_task_role.data.aws_iam_policy_document.assume_role[0]: Reading...
2023-03-22T11:58:20.3758275Z ##[debug]module.ecs_task_role.data.aws_iam_policy_document.assume_role[0]: Read complete after 0s [id=3683910268]
2023-03-22T11:58:20.3758850Z ##[debug]module.ecs_task_execution_role.aws_iam_role.this[0]: Refreshing state... [id=***-gatewayEcsTaskExecutionRole]
2023-03-22T11:58:20.3759394Z ##[debug]module.ecs_task_role.aws_iam_role.this[0]: Refreshing state... [id=***-gatewayEcsTaskRole]
2023-03-22T11:58:20.3759962Z ##[debug]module.ecs_task_policy.aws_iam_policy.policy[0]: Refreshing state... [id=arn:aws:iam::***:policy/***-gatewayEcsTaskPolicy]
2023-03-22T11:58:20.3760483Z ##[debug]module.records_alb[0].data.aws_route53_zone.this[0]: Read complete after 0s [id=Z07324142IRNV5R7DVHZ3]
2023-03-22T11:58:20.3761130Z ##[debug]module.ecs_task_execution_role.aws_iam_role_policy_attachment.custom[0]: Refreshing state... [id=***-gatewayEcsTaskExecutionRole-20230308173843538800000003]
2023-03-22T11:58:20.3761776Z ##[debug]module.records_alb[0].aws_route53_record.this["gateway A"]: Refreshing state... [id=Z07324142IRNV5R7DVHZ3_gateway.dev.uptain.io_A]
2023-03-22T11:58:20.3762555Z ##[debug]module.ecs_task_role.aws_iam_role_policy_attachment.custom[1]: Refreshing state... [id=***-gatewayEcsTaskRole-20230308173843571400000004]
2023-03-22T11:58:20.3763232Z ##[debug]module.ecs_task_role.aws_iam_role_policy_attachment.custom[0]: Refreshing state... [id=***-gatewayEcsTaskRole-20230308173843573000000005]
2023-03-22T11:58:20.3763780Z ##[debug]module.records_alb_admin[0].data.aws_route53_zone.this[0]: Read complete after 1s [id=Z07324142IRNV5R7DVHZ3]
2023-03-22T11:58:20.3765274Z ##[debug]module.records_alb_admin[0].aws_route53_record.this["admin-gateway A"]: Refreshing state... [id=Z07324142IRNV5R7DVHZ3_admin-gateway.dev.uptain.io_A]
2023-03-22T11:58:20.3765886Z ##[debug]module.backend_container_sg.aws_security_group_rule.ingress_with_cidr_blocks[1]: Refreshing state... [id=sgrule-2854334244]
2023-03-22T11:58:20.3766428Z ##[debug]module.backend_container_sg.aws_security_group_rule.egress_rules[0]: Refreshing state... [id=sgrule-2544472721]
2023-03-22T11:58:20.3766963Z ##[debug]module.backend_container_sg.aws_security_group_rule.ingress_with_cidr_blocks[0]: Refreshing state... [id=sgrule-2011127756]
2023-03-22T11:58:20.3767499Z ##[debug]aws_ecs_task_definition.service: Refreshing state... [id=***_gateway_task]
2023-03-22T11:58:20.3768106Z ##[debug]aws_lb_listener_rule.service[0]: Refreshing state... [id=arn:aws:elasticloadbalancing:***:***:listener-rule/app/***-alb/a01d64a3038cfcba/e4bee5109d5598d6/a1ae966abe45df8a]
2023-03-22T11:58:20.3768810Z ##[debug]aws_lb_listener_rule.service_admin[0]: Refreshing state... [id=arn:aws:elasticloadbalancing:***:***:listener-rule/app/***-alb/a01d64a3038cfcba/e4bee5109d5598d6/7f68d9419579715e]
2023-03-22T11:58:20.3769612Z ##[debug]aws_ecs_service.service: Refreshing state... [id=arn:aws:ecs:***:***:service/***-cluster/***_gateway_service]
2023-03-22T11:58:20.3770181Z ##[debug]aws_appautoscaling_target.backend_scaling: Refreshing state... [id=service/***-cluster/***_gateway_service]
2023-03-22T11:58:20.3770771Z ##[debug]aws_appautoscaling_policy.target_tracking_scaling_memory_backend: Refreshing state... [id=TargetTrackingScaling_memory_backend-***]
2023-03-22T11:58:20.3771413Z ##[debug]aws_appautoscaling_policy.target_tracking_scaling_cpu_backend: Refreshing state... [id=TargetTrackingScaling_cpu_backend-***]
2023-03-22T11:58:20.3771813Z ##[debug]
2023-03-22T11:58:20.3772301Z ##[debug]stderr: 
2023-03-22T11:58:20.3772725Z ##[debug]exitcode: 0
2023-03-22T11:58:20.3840102Z ##[debug]Set output stdout = Terraform v1.4.0
2023-03-22T11:58:20.3840442Z ##[debug]on linux_amd64
2023-03-22T11:58:20.3840678Z ##[debug]
2023-03-22T11:58:20.3840982Z ##[debug]Your version of Terraform is out of date! The latest version
2023-03-22T11:58:20.3841442Z ##[debug]is 1.4.2. You can update by downloading from https://www.terraform.io/downloads.html
2023-03-22T11:58:20.3842067Z ##[debug]
2023-03-22T11:58:20.3842404Z ##[debug]Set output stderr = 
2023-03-22T11:58:20.3842733Z ##[debug]Set output exitcode = 0
2023-03-22T11:58:20.3843201Z ##[debug]Set output stdout = 
2023-03-22T11:58:20.3843518Z ##[debug][0m[1mInitializing the backend...[0m
2023-03-22T11:58:20.3843967Z ##[debug][0m[32m
2023-03-22T11:58:20.3844493Z ##[debug]Successfully configured the backend "s3"! Terraform will automatically
2023-03-22T11:58:20.3844913Z ##[debug]use this backend unless the backend configuration changes.[0m
2023-03-22T11:58:20.3845269Z ##[debug][0m[1mInitializing modules...[0m
2023-03-22T11:58:20.3845722Z ##[debug]Downloading registry.terraform.io/terraform-aws-modules/security-group/aws 4.17.1 for backend_container_sg...
2023-03-22T11:58:20.3846253Z ##[debug]- backend_container_sg in .terraform/modules/backend_container_sg
2023-03-22T11:58:20.3846809Z ##[debug]Downloading registry.terraform.io/terraform-aws-modules/iam/aws 4.24.1 for ecs_task_execution_role...
2023-03-22T11:58:20.3847404Z ##[debug]- ecs_task_execution_role in .terraform/modules/ecs_task_execution_role/modules/iam-assumable-role
2023-03-22T11:58:20.3847998Z ##[debug]Downloading registry.terraform.io/terraform-aws-modules/iam/aws 4.24.1 for ecs_task_policy...
2023-03-22T11:58:20.3848801Z ##[debug]- ecs_task_policy in .terraform/modules/ecs_task_policy/modules/iam-policy
2023-03-22T11:58:20.3849344Z ##[debug]Downloading registry.terraform.io/terraform-aws-modules/iam/aws 4.24.1 for ecs_task_role...
2023-03-22T11:58:20.3850015Z ##[debug]- ecs_task_role in .terraform/modules/ecs_task_role/modules/iam-assumable-role
2023-03-22T11:58:20.3850686Z ##[debug]Downloading registry.terraform.io/cloudposse/ecs-container-definition/aws 0.58.2 for envoy_container_definition...
2023-03-22T11:58:20.3851270Z ##[debug]- envoy_container_definition in .terraform/modules/envoy_container_definition
2023-03-22T11:58:20.3851823Z ##[debug]Downloading registry.terraform.io/terraform-aws-modules/route53/aws 2.10.2 for records_alb...
2023-03-22T11:58:20.3852354Z ##[debug]- records_alb in .terraform/modules/records_alb/modules/records
2023-03-22T11:58:20.3852912Z ##[debug]Downloading registry.terraform.io/terraform-aws-modules/route53/aws 2.10.2 for records_alb_admin...
2023-03-22T11:58:20.3853462Z ##[debug]- records_alb_admin in .terraform/modules/records_alb_admin/modules/records
2023-03-22T11:58:20.3854060Z ##[debug]Downloading registry.terraform.io/cloudposse/ecs-container-definition/aws 0.58.2 for service_container_definition...
2023-03-22T11:58:20.3854643Z ##[debug]- service_container_definition in .terraform/modules/service_container_definition
2023-03-22T11:58:20.3855271Z ##[debug]Downloading registry.terraform.io/cloudposse/ecs-container-definition/aws 0.58.2 for service_worker_container_definition...
2023-03-22T11:58:20.3855880Z ##[debug]- service_worker_container_definition in .terraform/modules/service_worker_container_definition
2023-03-22T11:58:20.3856306Z ##[debug]
2023-03-22T11:58:20.3856667Z ##[debug][0m[1mInitializing provider plugins...[0m
2023-03-22T11:58:20.3857149Z ##[debug]- Finding hashicorp/aws versions matching ">= 2.49.0, >= 3.29.0, >= 3.34.0, >= 3.35.0, ~> 4.37"...
2023-03-22T11:58:20.3857594Z ##[debug]- Installing hashicorp/aws v4.59.0...
2023-03-22T11:58:20.3858019Z ##[debug]- Installed hashicorp/aws v4.59.0 (signed by HashiCorp)
2023-03-22T11:58:20.3858424Z ##[debug]
2023-03-22T11:58:20.3858856Z ##[debug]Terraform has created a lock file [1m.terraform.lock.hcl[0m to record the provider
2023-03-22T11:58:20.3859383Z ##[debug]selections it made above. Include this file in your version control repository
2023-03-22T11:58:20.3859870Z ##[debug]so that Terraform can guarantee to make the same selections by default when
2023-03-22T11:58:20.3860304Z ##[debug]you run "terraform init" in the future.[0m
2023-03-22T11:58:20.3860677Z ##[debug]
2023-03-22T11:58:20.3861054Z ##[debug][0m[1m[32mTerraform has been successfully initialized![0m[32m[0m
2023-03-22T11:58:20.3861578Z ##[debug][0m[32m
2023-03-22T11:58:20.3861986Z ##[debug]You may now begin working with Terraform. Try running "terraform plan" to see
2023-03-22T11:58:20.3862530Z ##[debug]any changes that are required for your infrastructure. All Terraform commands
2023-03-22T11:58:20.3862948Z ##[debug]should now work.
2023-03-22T11:58:20.3863250Z ##[debug]
2023-03-22T11:58:20.3863754Z ##[debug]If you ever set or change modules or backend configuration for Terraform,
2023-03-22T11:58:20.3864286Z ##[debug]rerun this command to reinitialize your working directory. If you forget, other
2023-03-22T11:58:20.3864771Z ##[debug]commands will detect it and remind you to do so if necessary.[0m
2023-03-22T11:58:20.3865142Z ##[debug]
2023-03-22T11:58:20.3865539Z ##[debug]Set output stderr = 
2023-03-22T11:58:20.3865961Z ##[debug]Set output exitcode = 0
2023-03-22T11:58:20.3866890Z ##[debug]Set output stdout = aws_service_discovery_service.service: Refreshing state... [id=srv-izgxsrt2qiapipfr]
2023-03-22T11:58:20.3867638Z ##[debug]aws_lb_target_group.service[0]: Refreshing state... [id=arn:aws:elasticloadbalancing:***:***:targetgroup/alb-***-gateway/9fd77cca51c4349f]
2023-03-22T11:58:20.3868266Z ##[debug]aws_cloudwatch_log_group.service_logs: Refreshing state... [id=***-gateway-logs]
2023-03-22T11:58:20.3869148Z ##[debug]aws_lb_target_group.service_admin[0]: Refreshing state... [id=arn:aws:elasticloadbalancing:***:***:targetgroup/admin-***-gateway/e6a2d97a5d1e492e]
2023-03-22T11:58:20.3869826Z ##[debug]aws_cloudwatch_log_group.envoy_logs: Refreshing state... [id=***-gateway-envoy-logs]
2023-03-22T11:58:20.3870378Z ##[debug]aws_appmesh_virtual_gateway.ingress[0]: Refreshing state... [id=65d8af21-10ff-4afc-adba-b75339a14945]
2023-03-22T11:58:20.3870918Z ##[debug]module.records_alb_admin[0].data.aws_route53_zone.this[0]: Reading...
2023-03-22T11:58:20.3871382Z ##[debug]data.aws_iam_policy_document.ecs_task_policy: Reading...
2023-03-22T11:58:20.3871939Z ##[debug]module.backend_container_sg.aws_security_group.this_name_prefix[0]: Refreshing state... [id=sg-0ed0ad9ce0caf3332]
2023-03-22T11:58:20.3872496Z ##[debug]data.aws_iam_policy_document.ecs_task_policy: Read complete after 0s [id=2177423719]
2023-03-22T11:58:20.3873028Z ##[debug]module.records_alb[0].data.aws_route53_zone.this[0]: Reading...
2023-03-22T11:58:20.3873554Z ##[debug]module.ecs_task_execution_role.data.aws_iam_policy_document.assume_role[0]: Reading...
2023-03-22T11:58:20.3874124Z ##[debug]module.ecs_task_execution_role.data.aws_iam_policy_document.assume_role[0]: Read complete after 0s [id=3683910268]
2023-03-22T11:58:20.3874684Z ##[debug]module.ecs_task_role.data.aws_iam_policy_document.assume_role[0]: Reading...
2023-03-22T11:58:20.3875222Z ##[debug]module.ecs_task_role.data.aws_iam_policy_document.assume_role[0]: Read complete after 0s [id=3683910268]
2023-03-22T11:58:20.3875883Z ##[debug]module.ecs_task_execution_role.aws_iam_role.this[0]: Refreshing state... [id=***-gatewayEcsTaskExecutionRole]
2023-03-22T11:58:20.3876501Z ##[debug]module.ecs_task_role.aws_iam_role.this[0]: Refreshing state... [id=***-gatewayEcsTaskRole]
2023-03-22T11:58:20.3877197Z ##[debug]module.ecs_task_policy.aws_iam_policy.policy[0]: Refreshing state... [id=arn:aws:iam::***:policy/***-gatewayEcsTaskPolicy]
2023-03-22T11:58:20.3877790Z ##[debug]module.records_alb[0].data.aws_route53_zone.this[0]: Read complete after 0s [id=Z07324142IRNV5R7DVHZ3]
2023-03-22T11:58:20.3878542Z ##[debug]module.ecs_task_execution_role.aws_iam_role_policy_attachment.custom[0]: Refreshing state... [id=***-gatewayEcsTaskExecutionRole-20230308173843538800000003]
2023-03-22T11:58:20.3879266Z ##[debug]module.records_alb[0].aws_route53_record.this["gateway A"]: Refreshing state... [id=Z07324142IRNV5R7DVHZ3_gateway.dev.uptain.io_A]
2023-03-22T11:58:20.3880025Z ##[debug]module.ecs_task_role.aws_iam_role_policy_attachment.custom[1]: Refreshing state... [id=***-gatewayEcsTaskRole-20230308173843571400000004]
2023-03-22T11:58:20.3880787Z ##[debug]module.ecs_task_role.aws_iam_role_policy_attachment.custom[0]: Refreshing state... [id=***-gatewayEcsTaskRole-20230308173843573000000005]
2023-03-22T11:58:20.3906884Z ##[debug]module.records_alb_admin[0].data.aws_route53_zone.this[0]: Read complete after 1s [id=Z07324142IRNV5R7DVHZ3]
2023-03-22T11:58:20.3907508Z ##[debug]module.records_alb_admin[0].aws_route53_record.this["admin-gateway A"]: Refreshing state... [id=Z07324142IRNV5R7DVHZ3_admin-gateway.dev.uptain.io_A]
2023-03-22T11:58:20.3908125Z ##[debug]module.backend_container_sg.aws_security_group_rule.ingress_with_cidr_blocks[1]: Refreshing state... [id=sgrule-2854334244]
2023-03-22T11:58:20.3908677Z ##[debug]module.backend_container_sg.aws_security_group_rule.egress_rules[0]: Refreshing state... [id=sgrule-2544472721]
2023-03-22T11:58:20.3909207Z ##[debug]module.backend_container_sg.aws_security_group_rule.ingress_with_cidr_blocks[0]: Refreshing state... [id=sgrule-2011127756]
2023-03-22T11:58:20.3909748Z ##[debug]aws_ecs_task_definition.service: Refreshing state... [id=***_gateway_task]
2023-03-22T11:58:20.3910363Z ##[debug]aws_lb_listener_rule.service[0]: Refreshing state... [id=arn:aws:elasticloadbalancing:***:***:listener-rule/app/***-alb/a01d64a3038cfcba/e4bee5109d5598d6/a1ae966abe45df8a]
2023-03-22T11:58:20.3911102Z ##[debug]aws_lb_listener_rule.service_admin[0]: Refreshing state... [id=arn:aws:elasticloadbalancing:***:***:listener-rule/app/***-alb/a01d64a3038cfcba/e4bee5109d5598d6/7f68d9419579715e]
2023-03-22T11:58:20.3912006Z ##[debug]aws_ecs_service.service: Refreshing state... [id=arn:aws:ecs:***:***:service/***-cluster/***_gateway_service]
2023-03-22T11:58:20.3912567Z ##[debug]aws_appautoscaling_target.backend_scaling: Refreshing state... [id=service/***-cluster/***_gateway_service]
2023-03-22T11:58:20.3913208Z ##[debug]aws_appautoscaling_policy.target_tracking_scaling_memory_backend: Refreshing state... [id=TargetTrackingScaling_memory_backend-***]
2023-03-22T11:58:20.3913827Z ##[debug]aws_appautoscaling_policy.target_tracking_scaling_cpu_backend: Refreshing state... [id=TargetTrackingScaling_cpu_backend-***]
2023-03-22T11:58:20.3914232Z ##[debug]
2023-03-22T11:58:20.3914556Z ##[debug]Set output stderr = 
2023-03-22T11:58:20.3914874Z ##[debug]Set output exitcode = 0
2023-03-22T11:58:20.3915471Z ##[debug]Finishing: Terragrunt Plan
```


<br />
***


**zahornyak** commented *Mar 22, 2023*

Fixed by changing terraform version from `1.4.0` to `1.4.2`
***


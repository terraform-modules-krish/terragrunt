# You must define a backend block (it can be empty!) in your Terraform code or your remote state settings will have no effect

**smitthakkar96** commented *Sep 27, 2021*

Maybe this is a duplicate but I am confused about all answers. 

I am using `terragrunt` version `0.31.0` and terraform `1.0.1`. My remote state settings are as follows:
``` hcl
remote_state = {
  backend = "s3"
  generate = {
    path      = "${get_terragrunt_dir()}/backend.tf"
    if_exists = "overwrite"
  }
  config = {
    encrypt = true
    bucket  = local.env_vars.bucket
    key     = "${local.env_vars.remote_state_path_prefix}/${replace(path_relative_to_include(), "../", "")}/terraform.tfstate"
    region  = local.env_vars.region
    profile = local.env_vars.account
  }
}
```
Above creates `backend.tf` like below
```
# Generated by Terragrunt. Sig: nIlQXj57tbuaRZEa
terraform {
  backend "s3" {
    bucket  = "bucket-name"
    encrypt = true
    key     = "terragrunt/squads/billing/billing-asia-golden-signals/production/terraform.tfstate"
    profile = "aws-profile"
    region  = "eu-central-1"
  }
}
```

When I run `terragrunt run-all plan` for the first time it fails with below error:
```
time=2021-09-27T19:15:29Z level=info msg=Stack at squads/billing/billing-asia-golden-signals/production:
  => Module /apps/squads/billing/billing-asia-golden-signals/production (excluded: false, dependencies: [])
time=2021-09-27T19:15:30Z level=error msg=Module /apps/squads/billing/billing-asia-golden-signals/production has finished with an error: Found remote_state settings in /apps/squads/billing/billing-asia-golden-signals/production/terragrunt.hcl but no backend block in the Terraform code in /apps/squads/billing/billing-asia-golden-signals/production/.terragrunt-cache/jL-ok05zqKOgZxB9eaCJVfscinM/V6_t61o1qpIBPcpuPFw1qQ5n_hg/terraform/modules/golden-signals. You must define a backend block (it can be empty!) in your Terraform code or your remote state settings will have no effect! It should look something like this:

terraform {
  backend "s3" {}
}

 prefix=[/apps/squads/billing/billing-asia-golden-signals/production] 
time=2021-09-27T19:15:30Z level=error msg=1 error occurred:
        * Found remote_state settings in /apps/squads/billing/billing-asia-golden-signals/production/terragrunt.hcl but no backend block in the Terraform code in /apps/squads/billing/billing-asia-golden-signals/production/.terragrunt-cache/jL-ok05zqKOgZxB9eaCJVfscinM/V6_t61o1qpIBPcpuPFw1qQ5n_hg/terraform/modules/golden-signals. You must define a backend block (it can be empty!) in your Terraform code or your remote state settings will have no effect! It should look something like this:

terraform {
  backend "s3" {}
}




time=2021-09-27T19:15:30Z level=error msg=Unable to determine underlying exit code, so Terragrunt will exit with error code 1
```

In the second attempt everything runs fine I guess it's because `backend.tf` is present.

I tried digging in code and I don't understand the reason behind `https://github.com/gruntwork-io/terragrunt/blob/fed8039a6f08c2816bd18d6377c77b379ccbc345/cli/cli_app.go#L467` this check (is it possible to maybe disable it). I even tried adding empty backend block to my module but when I do that I get below error

```
Initializing the backend...
bucket
  The name of the S3 bucket

  Enter a value: ╷
│ Error: Error asking for input to configure backend "s3": bucket: EOF
│ 
│ 
╵

╷
│ Error: "region": required field is not set
│ 
│ 
╵

╷
│ Error: "key": required field is not set
│ 
│ 
╵

╷
│ Error: "bucket": required field is not set
│ 
│ 
╵


time=2021-09-27T18:53:51Z level=error msg=1 error occurred:
        * exit status 1


make: *** [plan-all] Error 1
```
Even tried `disable_init` flag. Maybe I am doing something wrong or maybe there is a possible fix needed. 
<br />
***


**yorinasub17** commented *Sep 27, 2021*

**(intentionally hidden due to inaccuracy)**

EDIT: Ah ignore what I had below. I completely misread the logs.

---
The `generate` flag is for modules that don't have the empty backend block:

```
terraform {
  backend "s3" {}
}
```

Since you have that defined in the modules, you don't want to use the `generate` config on the `remote_state`.

So to fix this, you need to do one of the following (but NOT both as that would break in the opposite way):

- Remove the empty `s3` backend block in your terraform module.
- Remove the `generate` attr from the `remote_state` config.
***

**yorinasub17** commented *Sep 27, 2021*

Ok this is probably a bug, and a potential fix is at https://github.com/gruntwork-io/terragrunt/pull/1827. You can follow that PR to be notified when this is released.
***

**smitthakkar96** commented *Sep 27, 2021*

Your fix fixes the problem. @yorinasub17 thanks for the prompt response hope it's rolled out soon. 
***

**yorinasub17** commented *Sep 28, 2021*

Should be fixed in https://github.com/gruntwork-io/terragrunt/releases/tag/v0.32.5 (binaries should show up shortly, ~15-30 minutes).
***


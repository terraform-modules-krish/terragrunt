# sas token not being recognized for azurerm backend

**koka424** commented *Oct 12, 2019*

**Context (Environment)**
terragrunt version v0.20.0
Terraform v0.12.10
azurerm 1.35.0

**Detailed Description**
I am using this module to create my storage account that will hold the remote state.

https://github.com/avinor/terraform-azurerm-remote-backend

I am using a script to pull the SAS token for access to the Azure storage account. For testing purposes I hard coded the SAS token in the remote_state backend config. I thought that maybe this was a Terraform thing. I set the backend in a Terraform config to be empty so that I could run the same command being generated by Terragrunt and everything worked.

Here is an example of the backend-config line for the SAS token that Terragrunt is generating. This same line works when I run it with Terraform. And the token works with Terragrunt if I set it as the value for ARM_SAS_TOKEN.

`-backend-config=sas_token="?sv=YYYY-MM-DD&ss=b&xxx=xxx&xx=xxx&xx=2019-10-13T01:40:08Z&spr=https&sig=%2B%2By...xwA%3D"`

I tried wrapping it in quotes and passing it with no quotes in the terragrunt.hcl remote_state config and I get the same result.

I did my best to make sure that I included all the information that I could think of. If I forgot anything please let me know and I will provide it.

**Steps to Reproduce**

Run https://github.com/avinor/terraform-azurerm-remote-backend to create the storage account.

I initially ran this with the local state file and then ran against the remote following the steps outlined here: https://blog.gruntwork.io/how-to-manage-terraform-state-28f5697e68fa

Here is my backend configuration:

```
remote_state {
  backend = "azurerm"
  config = {
    storage_account_name = "tfstatedvsa"
    container_name       = "state"
    key                  = "${path_relative_to_include()}/terraform.state"
    sas_token            = run_cmd("${get_parent_terragrunt_dir()}/set-access-key.sh", "tfstatedv")
  }
} 
```

While testing I found that if I set the ARM_SAS_TOKEN environment variable this would run and Terragrunt was able to access the remote state. I did this for the init after using the local state to create the storage account.

When `sas_token` is defined in the config, whether it is running the script or hard coded, I get the error below.

**Current Behavior**
When using the remote state backend and trying to use a SAS token I get the following error message:

`Error: Either an Access Key / SAS Token or the Resource Group for the Storage Account must be specified`

**Expected Behavior**
That the sas token will be passed granting access to the remote state in the storage account.

**Possible Solution**
I do not have a solution but I have a work around. I am able to set the token as an env_var using extra_arguments:
```
terraform {
  extra_arguments "get_sas" {
    commands = [
      "init",
      "apply",
      "refresh",
      "import",
      "plan",
      "taint",
      "untaint"
    ]

    env_vars = {
      ARM_SAS_TOKEN = run_cmd("${get_parent_terragrunt_dir()}/set-access-key.sh", "tfstatedv")
    }
  }
}
```
Note: I had to modify the set-access-key.sh script in the https://github.com/avinor/terraform-azurerm-remote-backend because the output contained a new line. After I stripped the newline it worked fine. I did go back through all of my testing again and had the same results.
<br />
***


